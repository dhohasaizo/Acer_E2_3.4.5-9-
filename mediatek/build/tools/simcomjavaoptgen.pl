#!usr/bin/perl
#create by zhangjin 2013-1-16

#my $root_config_out = $ARGV[1];
my $project_name = simcom89_wet_jb2;
#my $project_name = $ARGV[2];
my $configFile = "mediatek/config/$project_name/SimcomProjectConfig.mk";


die "the file $configFile is NOT exsit\n" if ( ! -e $configFile);

open FILE, "<$configFile";
my %config_for;
while (<FILE>) {
	if (/^(\w+)\s*=\s*(\w+)/) {
		$config_for{$1} = $2;
	}
}
close FILE;



my $filedir = "mediatek/frameworks/common/src/com/mediatek/common/featureoption";
my $write_filename = "$filedir/SimcomFeatureOption.java";
my $input_file = "mediatek/build/tools/simcomjavaoption.pm";
open(INPUT,$input_file) or die "can not open $input_file:$!\n";
while(<INPUT>)
{
	chomp;
	next if(/^\#/);
	next if(/^\s*$/);
	push (@need_options,$1) if(/\s*(\w+)\s*/);
}


system("chmod u+w $write_filename") if (-e $write_filename);
system("mkdir -p $filedir") if ( ! -d "$filedir");
die "can NOT open $write_filename:$!" if ( ! open OUT_FILE, ">$write_filename");
print OUT_FILE "\/*auto generated by simcom *\/\n\n";
print OUT_FILE "package com.mediatek.common.featureoption;\n";
print OUT_FILE "\npublic final class SimcomFeatureOption\n{\n";
foreach my $option (@need_options) {
	if(!($config_for{$option} =~/\D/) && ($config_for{$option} ne "")){
		&gen_java_file_for_int_type ($write_filename, $option, $config_for{$option});
	}else{
		if ($config_for{$option} eq "yes") {
			&gen_java_file ($write_filename, $option, "true");
		}
		elsif ($config_for{$option} eq "no"){
			&gen_java_file ($write_filename, $option, "false");
		}
		elsif ($config_for{$option} ne ""){
			&gen_java_file_for_string_type ($write_filename, $option, $config_for{$option});
		}
		else
		{
			&gen_java_file ($write_filename, $option, "false");
		}
	}
}
print OUT_FILE "}\n";
close OUT_FILE;
sub gen_java_file {
	my ($filename, $option, $value) = @_;
	print OUT_FILE "    /**\n     * check if $option is turned on or not\n     */\n";

	print OUT_FILE "    public static final boolean ${option} = $value;\n\n";
}

sub gen_java_file_for_string_type {
	my ($filename, $option, $value) = @_;
	print OUT_FILE "    /**\n     * check if $option is turned on or not\n     */\n";
	print OUT_FILE "    public static final String ${option} = \"$value\";\n\n";

}

sub gen_java_file_for_int_type {
	my ($filename, $option, $value) = @_;
	print OUT_FILE "    /**\n     * check the int value of $option \n     */\n";
	print OUT_FILE "    public static final int ${option} = $value;\n\n";

}
